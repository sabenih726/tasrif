<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TASHRIF SHOROF PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“–</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Space+Mono:wght@400;700&family=Bebas+Neue&display=swap');
        
        * { box-sizing: border-box; }

        body { 
            font-family: 'Space Mono', monospace; 
            background-color: #f5f5dc;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 30px, rgba(0,0,0,0.03) 30px, rgba(0,0,0,0.03) 31px),
                repeating-linear-gradient(90deg, transparent, transparent 30px, rgba(0,0,0,0.03) 30px, rgba(0,0,0,0.03) 31px);
            min-height: 100vh;
        }

        .arabic-text { font-family: 'Amiri', serif; direction: rtl; }
        .brutal-border { border: 3px solid #000; }
        .brutal-shadow { box-shadow: 4px 4px 0px #000; }
        .brutal-shadow-lg { box-shadow: 6px 6px 0px #000; }

        @media (min-width: 768px) {
            .brutal-border { border: 4px solid #000; }
            .brutal-shadow { box-shadow: 8px 8px 0px #000; }
            .brutal-shadow-lg { box-shadow: 12px 12px 0px #000; }
        }

        .brutal-btn {
            border: 3px solid #000;
            box-shadow: 4px 4px 0px #000;
            transition: all 0.1s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (min-width: 768px) {
            .brutal-btn {
                border: 4px solid #000;
                box-shadow: 6px 6px 0px #000;
                letter-spacing: 2px;
            }
        }

        .brutal-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000; }
        .brutal-btn:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px #000; }

        /* ===== CSS YANG HILANG - DITAMBAHKAN ===== */
        
        /* API Key Section Styles */
        .api-key-section {
            background: #fff3cd;
            border: 3px solid #000;
            box-shadow: 6px 6px 0px #000;
            padding: 1.5rem;
        }

        @media (min-width: 768px) {
            .api-key-section {
                border: 4px solid #000;
                box-shadow: 8px 8px 0px #000;
                padding: 2rem;
            }
        }

        .api-key-saved {
            background: #d1fae5;
            border: 3px solid #000;
            box-shadow: 6px 6px 0px #000;
            padding: 1.5rem;
        }

        @media (min-width: 768px) {
            .api-key-saved {
                border: 4px solid #000;
                box-shadow: 8px 8px 0px #000;
                padding: 2rem;
            }
        }

        .api-key-input-wrapper {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        @media (min-width: 640px) {
            .api-key-input-wrapper {
                flex-direction: row;
                align-items: center;
            }
        }

        /* Brutal Input Small */
        .brutal-input-sm {
            border: 3px solid #000;
            background: #fff;
            font-family: 'Space Mono', monospace;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }

        .brutal-input-sm:focus {
            outline: none;
            background: #ffffa0;
        }

        /* Brutal Button Small */
        .brutal-btn-sm {
            border: 2px solid #000;
            box-shadow: 3px 3px 0px #000;
            transition: all 0.1s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .brutal-btn-sm:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0px #000;
        }

        .brutal-btn-sm:active {
            transform: translate(3px, 3px);
            box-shadow: 0px 0px 0px #000;
        }

        /* Toggle Visibility Button */
        .toggle-visibility {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #666;
            transition: color 0.2s;
        }

        .toggle-visibility:hover {
            color: #000;
        }

        /* Collapsible Styles */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: #e5e7eb;
            border: 2px solid #000;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            transition: background 0.2s;
        }

        .collapsible-header:hover {
            background: #d1d5db;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            background: #f9fafb;
            border: 2px solid #000;
            border-top: none;
            padding: 0 1rem;
        }

        .collapsible-content.open {
            max-height: 500px;
            padding: 1rem;
        }

        /* Chevron Icon */
        .chevron {
            transition: transform 0.3s ease;
        }

        .chevron.open {
            transform: rotate(180deg);
        }

        /* Status Badge Warning */
        .status-warning {
            background: #fed7aa;
        }

        /* ===== AKHIR CSS YANG DITAMBAHKAN ===== */

        .brutal-input {
            border: 3px solid #000;
            background: #fff;
            font-family: 'Space Mono', monospace;
        }

        @media (min-width: 768px) {
            .brutal-input { border: 4px solid #000; }
        }

        .brutal-input:focus { outline: none; background: #ffffa0; }

        .card-brutal {
            background: #fff;
            border: 3px solid #000;
            box-shadow: 6px 6px 0px #000;
        }

        @media (min-width: 768px) {
            .card-brutal {
                border: 4px solid #000;
                box-shadow: 12px 12px 0px #000;
            }
        }

        .header-brutal {
            background: #000;
            color: #fff;
            padding: 1.5rem 1rem;
            border-bottom: 3px solid #000;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .header-brutal {
                padding: 2.5rem 2rem;
                border-bottom: 4px solid #000;
            }
        }

        .header-brutal::before {
            content: "////";
            position: absolute; top: 8px; right: 12px;
            font-size: 1rem; opacity: 0.3; letter-spacing: -2px;
        }

        @media (min-width: 768px) {
            .header-brutal::before {
                content: "//////////";
                font-size: 1.5rem;
                right: 20px;
            }
        }

        .header-fiil { background: #000; }
        .header-isim { background: #1e40af; }
        .header-lughawi { background: #7c3aed; }

        .row-tashrif {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            border-bottom: 3px solid #000;
            background: #fff;
            gap: 8px;
        }

        .row-tashrif:hover { background: #ffff00; }

        @media (min-width: 768px) {
            .row-tashrif {
                display: grid;
                grid-template-columns: 160px 1fr 1fr 200px;
                align-items: center;
                padding: 1rem 1.5rem;
                gap: 16px;
            }
        }

        .row-isim {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            border-bottom: 3px solid #000;
            background: #fff;
            gap: 8px;
        }

        .row-isim:hover { background: #bfdbfe; }

        @media (min-width: 768px) {
            .row-isim {
                display: grid;
                grid-template-columns: 180px 1fr 1fr;
                align-items: center;
                padding: 1rem 1.5rem;
                gap: 16px;
            }
        }

        .label-cell { 
            font-size: 0.6rem; 
            font-weight: 700; 
            text-transform: uppercase;
            background: #000;
            color: #fff;
            padding: 6px 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            align-self: flex-start;
        }

        @media (min-width: 768px) {
            .label-cell {
                font-size: 0.7rem;
                background: transparent;
                color: #000;
                padding: 0;
            }
        }

        .wazan-mauzun-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        @media (min-width: 768px) {
            .wazan-mauzun-container {
                display: contents;
            }
        }

        .wazan-cell { 
            font-size: 1.2rem; 
            color: #888;
            text-align: center;
        }

        @media (min-width: 768px) {
            .wazan-cell {
                font-size: 1.5rem;
            }
        }

        .mauzun-cell { 
            font-size: 1.6rem; 
            color: #000; 
            font-weight: 700;
            display: inline-block; 
            padding: 2px 8px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .mauzun-cell {
                font-size: 2.2rem;
                padding: 0 10px;
            }
        }

        .meaning-cell {
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            padding-top: 8px;
            border-top: 2px dashed #ccc;
        }

        @media (min-width: 768px) {
            .meaning-cell {
                font-size: 0.85rem;
                text-align: right;
                padding-top: 0;
                border-top: none;
            }
        }

        .marquee-container {
            background: #ff0000; 
            border: 3px solid #000;
            padding: 6px 0; 
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .marquee-container {
                border: 4px solid #000;
                padding: 8px 0;
            }
        }

        .marquee-text {
            display: inline-block; 
            white-space: nowrap;
            animation: marquee 20s linear infinite;
            font-weight: 700; 
            font-size: 0.65rem; 
            color: #fff;
            text-transform: uppercase; 
            letter-spacing: 2px;
        }

        @media (min-width: 768px) {
            .marquee-text {
                font-size: 0.8rem;
                letter-spacing: 4px;
                animation-duration: 25s;
            }
        }

        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .loader-brutal {
            width: 40px; 
            height: 40px;
            border: 4px solid #000; 
            border-top: 4px solid #ffff00;
            animation: spin 0.6s linear infinite;
        }

        @media (min-width: 768px) {
            .loader-brutal {
                width: 60px;
                height: 60px;
                border-width: 6px;
            }
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .zigzag {
            background: linear-gradient(135deg, #000 25%, transparent 25%) -10px 0,
                        linear-gradient(225deg, #000 25%, transparent 25%) -10px 0,
                        linear-gradient(315deg, #000 25%, transparent 25%),
                        linear-gradient(45deg, #000 25%, transparent 25%);
            background-size: 16px 16px; 
            background-color: #ffff00; 
            height: 16px;
        }

        .zigzag-blue {
            background: linear-gradient(135deg, #1e40af 25%, transparent 25%) -10px 0,
                        linear-gradient(225deg, #1e40af 25%, transparent 25%) -10px 0,
                        linear-gradient(315deg, #1e40af 25%, transparent 25%),
                        linear-gradient(45deg, #1e40af 25%, transparent 25%);
            background-size: 16px 16px; 
            background-color: #60a5fa; 
            height: 16px;
        }

        .zigzag-purple {
            background: linear-gradient(135deg, #7c3aed 25%, transparent 25%) -10px 0,
                        linear-gradient(225deg, #7c3aed 25%, transparent 25%) -10px 0,
                        linear-gradient(315deg, #7c3aed 25%, transparent 25%),
                        linear-gradient(45deg, #7c3aed 25%, transparent 25%);
            background-size: 16px 16px; 
            background-color: #a78bfa; 
            height: 16px;
        }

        @media (min-width: 768px) {
            .zigzag, .zigzag-blue, .zigzag-purple {
                background-size: 20px 20px;
                height: 20px;
            }
        }

        .header-table {
            display: none;
        }

        @media (min-width: 768px) {
            .header-table {
                display: grid;
                grid-template-columns: 160px 1fr 1fr 200px;
                background: #000; 
                color: #fff;
                padding: 0.75rem 1.5rem; 
                font-size: 0.65rem; 
                font-weight: 700;
                text-transform: uppercase; 
                letter-spacing: 2px;
            }
            
            .header-table-isim {
                display: grid;
                grid-template-columns: 180px 1fr 1fr;
                background: #1e40af; 
                color: #fff;
                padding: 0.75rem 1.5rem; 
                font-size: 0.65rem; 
                font-weight: 700;
                text-transform: uppercase; 
                letter-spacing: 2px;
            }
        }

        .title-main {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.5rem;
            line-height: 0.9;
        }

        @media (min-width: 480px) {
            .title-main { font-size: 5rem; }
        }

        @media (min-width: 768px) {
            .title-main { font-size: 7rem; }
        }

        @media (min-width: 1024px) {
            .title-main { font-size: 9rem; }
        }

        .input-arabic {
            font-size: 1.75rem;
            padding: 0.75rem;
        }

        @media (min-width: 768px) {
            .input-arabic {
                font-size: 2.5rem;
                padding: 1rem;
            }
        }

        .pattern-text {
            font-size: 2rem;
        }

        @media (min-width: 768px) {
            .pattern-text { font-size: 3.5rem; }
        }

        @media (min-width: 1024px) {
            .pattern-text { font-size: 4.5rem; }
        }

        .arrow-indicator {
            display: inline-block;
            font-size: 1.2rem;
            color: #888;
        }

        @media (min-width: 768px) {
            .arrow-indicator { display: none; }
        }

        .model-select {
            border: 3px solid #000;
            background: #fff;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            padding: 0.5rem;
            cursor: pointer;
        }

        .model-select:focus {
            outline: none;
            background: #ffffa0;
        }

        .type-btn {
            padding: 0.5rem 1rem;
            font-size: 0.7rem;
            font-weight: 700;
            border: 3px solid #000;
            cursor: pointer;
            transition: all 0.1s;
        }

        .type-btn.active {
            transform: translate(2px, 2px);
            box-shadow: none !important;
        }

        .type-btn-fiil { background: #fef08a; }
        .type-btn-fiil.active { background: #facc15; }
        .type-btn-isim { background: #bfdbfe; }
        .type-btn-isim.active { background: #3b82f6; color: #fff; }
        .type-btn-auto { background: #d1d5db; }
        .type-btn-auto.active { background: #6b7280; color: #fff; }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding: 1rem;
            background: #f0f9ff;
            border-bottom: 3px solid #000;
        }

        @media (min-width: 640px) {
            .info-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (min-width: 1024px) {
            .info-grid { grid-template-columns: repeat(4, 1fr); }
        }

        .info-card {
            background: #fff;
            border: 2px solid #000;
            padding: 0.75rem;
        }

        .info-label {
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 700;
        }

        .info-value-ar {
            font-size: 1.25rem;
        }

        .derivation-box {
            background: #fef3c7;
            border: 3px solid #000;
            padding: 1rem;
            margin: 1rem;
            text-align: center;
        }

        .derivation-arrow {
            font-size: 1.5rem;
            color: #666;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            font-size: 0.65rem;
            font-weight: 700;
            border: 2px solid #000;
        }

        .status-connected { background: #86efac; }
        .status-error { background: #fca5a5; }

        /* Tashrif Lughawi Styles */
        .lughawi-section {
            margin-top: 1.5rem;
        }

        .lughawi-title {
            background: #7c3aed;
            color: #fff;
            padding: 1rem;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lughawi-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0;
        }

        @media (min-width: 768px) {
            .lughawi-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .lughawi-column {
            border: 2px solid #000;
            border-top: none;
        }

        @media (min-width: 768px) {
            .lughawi-column {
                border-top: 2px solid #000;
            }
            .lughawi-column:not(:first-child) {
                border-left: none;
            }
        }

        .lughawi-column-header {
            background: #e9d5ff;
            padding: 0.75rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            border-bottom: 2px solid #000;
        }

        .lughawi-row {
            display: grid;
            grid-template-columns: 80px 1fr 1fr;
            border-bottom: 1px solid #ddd;
            background: #fff;
            transition: background 0.1s;
        }

        .lughawi-row:hover {
            background: #f3e8ff;
        }

        .lughawi-row:last-child {
            border-bottom: none;
        }

        .lughawi-dhamir {
            background: #f3e8ff;
            padding: 0.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .lughawi-dhamir-label {
            font-size: 0.5rem;
            color: #666;
            margin-top: 2px;
            font-family: 'Space Mono', monospace;
        }

        .lughawi-fiil {
            padding: 0.5rem;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #ddd;
        }

        .lughawi-meaning {
            padding: 0.5rem;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #555;
        }

        @media (min-width: 768px) {
            .lughawi-dhamir {
                font-size: 1.3rem;
            }
            .lughawi-fiil {
                font-size: 1.4rem;
            }
            .lughawi-meaning {
                font-size: 0.7rem;
            }
        }

        /* Gender color coding */
        .gender-male { background: #dbeafe; }
        .gender-female { background: #fce7f3; }
        .gender-mixed { background: #f0fdf4; }

        /* Tabs for Lughawi */
        .lughawi-tabs {
            display: flex;
            border: 2px solid #000;
            border-bottom: none;
            overflow-x: auto;
        }

        .lughawi-tab {
            flex: 1;
            min-width: 100px;
            padding: 0.75rem 1rem;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            cursor: pointer;
            background: #e9d5ff;
            border-right: 2px solid #000;
            transition: all 0.1s;
        }

        .lughawi-tab:last-child {
            border-right: none;
        }

        .lughawi-tab:hover {
            background: #c4b5fd;
        }

        .lughawi-tab.active {
            background: #7c3aed;
            color: #fff;
        }

        .lughawi-content {
            display: none;
        }

        .lughawi-content.active {
            display: block;
        }

        /* Section divider */
        .section-divider {
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #000 0px,
                #000 10px,
                transparent 10px,
                transparent 20px
            );
            margin: 2rem 0;
        }
    </style>
</head>
<body class="p-3 md:p-6 lg:p-8">

    <!-- Marquee Banner -->
    <div class="marquee-container brutal-shadow mb-4 md:mb-8">
        <div class="marquee-text">
            TASHRIF SHOROF â€” ISTILAHI & LUGHAWI â€” FI'IL & ISIM
        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        
        <!-- Title Section -->
        <div class="text-center mb-6 md:mb-10">
            <h1 class="title-main text-black">TASHRIF SHOROF</h1>
            <h1 class="title-main text-black" style="text-shadow: 4px 4px 0px #ffff00;">MAJELIS KALIBATA</h1>
            <div class="mt-4">
                <span id="statusBadge" class="status-badge status-warning">
                    <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                    API KEY REQUIRED
                </span>
            </div>
        </div>

        <!-- API Key Configuration Section -->
        <div id="apiKeySection" class="api-key-section mb-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-black text-white flex items-center justify-center text-xl">
                    <i class="fas fa-key"></i>
                </div>
                <div>
                    <h3 class="font-bold text-sm uppercase tracking-wider">Konfigurasi API Key</h3>
                    <p class="text-xs text-gray-600">API Key disimpan di browser Anda (localStorage)</p>
                </div>
            </div>
            
            <div class="api-key-input-wrapper mb-4">
                <div class="relative flex-1">
                    <input type="password" id="apiKeyInput" 
                        class="brutal-input-sm w-full pr-12"
                        placeholder="Masukkan Gemini API Key Anda..."
                        onkeypress="if(event.key === 'Enter') saveApiKey()">
                    <button onclick="toggleApiKeyVisibility()" class="toggle-visibility" title="Tampilkan/Sembunyikan">
                        <i id="visibilityIcon" class="fas fa-eye"></i>
                    </button>
                </div>
                <button onclick="saveApiKey()" id="saveKeyBtn" class="brutal-btn brutal-btn-sm bg-green-400 text-black whitespace-nowrap">
                    <i class="fas fa-save mr-1"></i> SIMPAN
                </button>
                <button onclick="deleteApiKey()" id="deleteKeyBtn" class="brutal-btn brutal-btn-sm bg-red-400 text-white whitespace-nowrap hidden">
                    <i class="fas fa-trash mr-1"></i> HAPUS
                </button>
            </div>
            
            <div id="apiKeyStatus" class="text-xs mb-3">
                <span class="text-orange-700">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    Belum ada API Key tersimpan
                </span>
            </div>
            
        <!-- Input Section -->
        <div class="card-brutal p-4 md:p-6 lg:p-10 mb-6 md:mb-12">
            
            <div class="flex flex-col md:flex-row md:items-end gap-4 mb-6">
                <div class="flex-1">
                    <label class="text-[10px] md:text-xs font-bold uppercase tracking-wider block underline mb-2">
                        <i class="fas fa-tags mr-1"></i> JENIS KATA
                    </label>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="setType('auto')" id="btnAuto" class="type-btn type-btn-auto brutal-shadow active">
                            <i class="fas fa-magic mr-1"></i> AUTO
                        </button>
                        <button onclick="setType('fiil')" id="btnFiil" class="type-btn type-btn-fiil brutal-shadow">
                            <i class="fas fa-running mr-1"></i> FI'IL
                        </button>
                        <button onclick="setType('isim')" id="btnIsim" class="type-btn type-btn-isim brutal-shadow">
                            <i class="fas fa-cube mr-1"></i> ISIM
                        </button>
                    </div>
                </div>
                
                <div class="w-full md:w-48">
                    <label class="text-[10px] md:text-xs font-bold uppercase tracking-wider block underline mb-2">
                        <i class="fas fa-robot mr-1"></i> MODEL
                    </label>
                    <select id="modelSelect" class="model-select w-full">
                        <option value="gemini-2.5-flash-preview-09-2025">Sabenih 2.5</option>
                    </select>
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-[10px] md:text-xs font-bold uppercase tracking-wider block underline">
                    <i class="fas fa-pen-fancy mr-1"></i> MASUKKAN KATA ARAB
                </label>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="userInput" 
                        class="arabic-text brutal-input input-arabic flex-1 w-full"
                        placeholder="Ù†ÙØµÙØ±Ù / ÙƒÙØ§ØªÙØ¨"
                        onkeypress="if(event.key === 'Enter') processWord()">
                    <button onclick="processWord()" id="processBtn"
                        class="brutal-btn bg-yellow-400 text-black px-6 py-3 md:py-0 md:px-10 flex items-center justify-center gap-2">
                        <i class="fas fa-bolt text-lg md:text-2xl"></i>
                        <span class="text-sm md:text-base">ANALISIS</span>
                    </button>
                </div>
            </div>

            <div class="mt-4 pt-3 border-t-2 border-dashed border-black">
                <p class="text-[10px] md:text-xs opacity-70">
                    <i class="fas fa-info-circle mr-1"></i>
                    <strong>Fi'il:</strong> Ù†ÙØµÙØ±ÙØŒ Ø¶ÙØ±ÙØ¨ÙØŒ Ø£ÙÙƒÙ’Ø±ÙÙ…ÙØŒ Ø¹ÙÙ„ÙÙ‘Ù…Ù &nbsp;|&nbsp;
                    <strong>Isim:</strong> ÙƒÙØ§ØªÙØ¨ØŒ Ù…ÙÙƒÙ’ØªÙÙˆØ¨ØŒ Ø·ÙØ§Ù„ÙØ¨ØŒ Ù…ÙØ¹ÙÙ„ÙÙ‘Ù…
                </p>
            </div>
        </div>

        <!-- Result Section - Fi'il -->
        <div id="resultFiil" class="hidden">
            <div class="card-brutal overflow-hidden">
                <div class="header-brutal header-fiil">
                    <div class="relative z-10">
                        <span class="inline-block bg-yellow-400 text-black px-3 py-1 font-bold text-[10px] md:text-xs mb-3 brutal-border">
                            <i class="fas fa-running mr-1"></i> <span id="babText">FI'IL ANALYZED</span>
                        </span>
                        <h2 id="patternText" class="arabic-text pattern-text font-bold">â€” â€” â€”</h2>
                        <p id="rootText" class="text-sm mt-2 opacity-70"></p>
                    </div>
                </div>
                <div class="zigzag"></div>
                
                <!-- Tashrif Istilahi Section -->
                <div class="bg-gray-100 px-4 py-2 border-b-2 border-black">
                    <span class="text-xs font-bold uppercase tracking-wider">
                        <i class="fas fa-list-ol mr-1"></i> TASHRIF ISTILAHI (10 Bentuk Dasar)
                    </span>
                </div>
                <div class="header-table">
                    <div>BENTUK</div>
                    <div class="text-center">WAZAN â†’ MAUZUN</div>
                    <div class="text-right">ARTI</div>
                </div>
                <div id="tashrifContainer"></div>

                <!-- Tashrif Lughawi Section -->
                <div class="lughawi-section">
                    <div class="lughawi-title">
                        <i class="fas fa-users"></i>
                        TASHRIF LUGHAWI (14 Dhamir)
                    </div>
                    
                    <!-- Tabs -->
                    <div class="lughawi-tabs">
                        <div class="lughawi-tab active" onclick="showLughawiTab('madhi')">
                            <i class="fas fa-history mr-1"></i> MADHI
                        </div>
                        <div class="lughawi-tab" onclick="showLughawiTab('mudhari')">
                            <i class="fas fa-clock mr-1"></i> MUDHARI
                        </div>
                        <div class="lughawi-tab" onclick="showLughawiTab('amr')">
                            <i class="fas fa-exclamation mr-1"></i> AMR
                        </div>
                    </div>

                    <!-- Tab Contents -->
                    <div id="lughawiMadhi" class="lughawi-content active"></div>
                    <div id="lughawiMudhari" class="lughawi-content"></div>
                    <div id="lughawiAmr" class="lughawi-content"></div>
                </div>

                <div class="bg-black text-white p-3 md:p-4 text-center text-[8px] md:text-[10px] font-bold tracking-[0.3em] md:tracking-[0.5em]">
                    // FI'IL_ANALYZER + TASHRIF_LUGHAWI //
                </div>
            </div>
        </div>

        <!-- Result Section - Isim -->
        <div id="resultIsim" class="hidden">
            <div class="card-brutal overflow-hidden">
                <div class="header-brutal header-isim">
                    <div class="relative z-10">
                        <span class="inline-block bg-blue-300 text-black px-3 py-1 font-bold text-[10px] md:text-xs mb-3 brutal-border">
                            <i class="fas fa-cube mr-1"></i> <span id="isimTypeText">ISIM ANALYZED</span>
                        </span>
                        <h2 id="isimWordText" class="arabic-text pattern-text font-bold">â€” â€” â€”</h2>
                    </div>
                </div>
                <div class="zigzag-blue"></div>
                
                <div class="info-grid" id="isimInfoGrid"></div>
                <div id="derivationSection" class="hidden"></div>
                
                <div class="header-table-isim hidden md:grid">
                    <div>BENTUK</div>
                    <div class="text-center">KATA ARAB</div>
                    <div class="text-right">KETERANGAN</div>
                </div>
                <div id="isimContainer"></div>
                
                <div class="bg-blue-800 text-white p-3 md:p-4 text-center text-[8px] md:text-[10px] font-bold tracking-[0.3em] md:tracking-[0.5em]">
                    // ISIM_ANALYZER //
                </div>
            </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="hidden py-16 md:py-24 text-center">
            <div class="inline-block mb-4 md:mb-6 loader-brutal"></div>
            <p class="text-base md:text-2xl font-black uppercase tracking-wider md:tracking-widest">[ ANALYZING... ]</p>
        </div>

    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-red-500 brutal-border brutal-shadow-lg p-6 md:p-8 max-w-md w-full text-center">
            <div class="text-4xl md:text-5xl mb-4">âš ï¸</div>
            <p id="errorMessage" class="text-white text-sm md:text-lg font-black mb-6 break-words">ERROR</p>
            <button onclick="closeModal()" class="brutal-btn bg-white px-6 py-2 text-sm md:text-base">OK</button>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 brutal-border brutal-shadow font-bold text-sm hidden z-50">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="toastMessage">Berhasil!</span>
    </div>

    <script>
        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘  ğŸ” API KEY MANAGEMENT - Stored in localStorage                â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const STORAGE_KEY = 'tashrif_gemini_api_key';
        let selectedType = 'auto';

        // ============ API KEY FUNCTIONS ============
        
        function getApiKey() {
            return localStorage.getItem(STORAGE_KEY) || '';
        }
        
        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            const key = input.value.trim();
            
            if (!key) {
                showBrutalAlert('Masukkan API Key terlebih dahulu!');
                return;
            }
            
            if (!key.startsWith('AIza')) {
                showBrutalAlert('Format API Key tidak valid! API Key Google biasanya dimulai dengan "AIza..."');
                return;
            }
            
            localStorage.setItem(STORAGE_KEY, key);
            updateApiKeyUI();
            showToast('API Key berhasil disimpan!');
            
            // Test the API key
            testApiKey(key);
        }
        
        function deleteApiKey() {
            if (confirm('Yakin ingin menghapus API Key?')) {
                localStorage.removeItem(STORAGE_KEY);
                document.getElementById('apiKeyInput').value = '';
                updateApiKeyUI();
                showToast('API Key berhasil dihapus!');
            }
        }
        
        function toggleApiKeyVisibility() {
            const input = document.getElementById('apiKeyInput');
            const icon = document.getElementById('visibilityIcon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }
        
        function updateApiKeyUI() {
            const key = getApiKey();
            const section = document.getElementById('apiKeySection');
            const status = document.getElementById('apiKeyStatus');
            const input = document.getElementById('apiKeyInput');
            const saveBtn = document.getElementById('saveKeyBtn');
            const deleteBtn = document.getElementById('deleteKeyBtn');
            const badge = document.getElementById('statusBadge');
            const processBtn = document.getElementById('processBtn');
            
            if (key) {
                // API Key exists
                section.classList.add('api-key-saved');
                section.classList.remove('api-key-section');
                
                // Show masked key
                const maskedKey = key.substring(0, 8) + '...' + key.substring(key.length - 4);
                input.value = key;
                input.placeholder = maskedKey;
                
                status.innerHTML = `
                    <span class="text-green-700">
                        <i class="fas fa-check-circle mr-1"></i>
                        API Key tersimpan: <code class="bg-green-200 px-2 py-0.5">${maskedKey}</code>
                    </span>
                `;
                
                saveBtn.innerHTML = '<i class="fas fa-sync mr-1"></i> UPDATE';
                deleteBtn.classList.remove('hidden');
                
                badge.className = 'status-badge status-connected';
                badge.innerHTML = '<span class="w-2 h-2 bg-green-600 rounded-full animate-pulse"></span> AI READY';
                
                processBtn.disabled = false;
            } else {
                // No API Key
                section.classList.remove('api-key-saved');
                section.classList.add('api-key-section');
                
                input.value = '';
                input.placeholder = 'Masukkan Gemini API Key Anda...';
                
                status.innerHTML = `
                    <span class="text-orange-700">
                        <i class="fas fa-exclamation-triangle mr-1"></i>
                        Belum ada API Key tersimpan
                    </span>
                `;
                
                saveBtn.innerHTML = '<i class="fas fa-save mr-1"></i> SIMPAN';
                deleteBtn.classList.add('hidden');
                
                badge.className = 'status-badge status-warning';
                badge.innerHTML = '<span class="w-2 h-2 bg-orange-500 rounded-full"></span> API KEY REQUIRED';
                
                processBtn.disabled = false; // Still allow click to show error message
            }
        }
        
        async function testApiKey(key) {
            const badge = document.getElementById('statusBadge');
            badge.innerHTML = '<span class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></span> TESTING...';
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                badge.className = 'status-badge status-connected';
                badge.innerHTML = '<span class="w-2 h-2 bg-green-600 rounded-full animate-pulse"></span> AI READY';
                showToast('API Key valid dan siap digunakan!');
                
            } catch (e) {
                badge.className = 'status-badge status-error';
                badge.innerHTML = '<span class="w-2 h-2 bg-red-600 rounded-full"></span> API KEY INVALID';
                showBrutalAlert('API Key tidak valid: ' + e.message);
            }
        }
        
        function toggleCollapsible(header) {
            const content = header.nextElementSibling;
            const chevron = header.querySelector('.chevron');
            
            content.classList.toggle('open');
            chevron.classList.toggle('open');
        }
        
        function showToast(message) {
            const toast = document.getElementById('successToast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // ============ MAIN FUNCTIONS ============

        function setType(type) {
            selectedType = type;
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('active');
        }

        function showLughawiTab(tab) {
            document.querySelectorAll('.lughawi-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.lughawi-tab').forEach(el => el.classList.remove('active'));
            document.getElementById('lughawi' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
            event.target.closest('.lughawi-tab').classList.add('active');
        }

        async function processWord() {
            const apiKey = getApiKey();
            const input = document.getElementById('userInput').value.trim();
            const modelName = document.getElementById('modelSelect').value;

            if (!apiKey) {
                showBrutalAlert("API KEY BELUM DIKONFIGURASI!\n\nSilakan masukkan API Key Gemini Anda di bagian konfigurasi di atas.");
                document.getElementById('apiKeyInput').focus();
                return;
            }

            if (!input) {
                showBrutalAlert("MASUKKAN KATA ARAB!");
                return;
            }

            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');
            document.getElementById('resultFiil').classList.add('hidden');
            document.getElementById('resultIsim').classList.add('hidden');

            let systemPrompt = getAutoPrompt(input);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Analisis kata Arab: ${input}` }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const json = await response.json();
                
                if (json.error) {
                    updateStatus(false);
                    
                    // Check for specific error types
                    if (json.error.message.includes('API key')) {
                        throw new Error(`API Key Error: ${json.error.message}\n\nSilakan periksa kembali API Key Anda.`);
                    }
                    throw new Error(`API Error: ${json.error.message}`);
                }
                
                if (!json.candidates || !json.candidates[0]) throw new Error("Response tidak valid");

                const res = JSON.parse(json.candidates[0].content.parts[0].text);
                
                updateStatus(true);
                
                if (res.type === 'fiil') {
                    renderFiilResult(res);
                } else {
                    renderIsimResult(res);
                }
                
            } catch (e) {
                console.error(e);
                showBrutalAlert(e.message || "TERJADI KESALAHAN!");
            } finally {
                loader.classList.add('hidden');
            }
        }

        function updateStatus(connected) {
            const badge = document.getElementById('statusBadge');
            if (connected) {
                badge.className = 'status-badge status-connected';
                badge.innerHTML = '<span class="w-2 h-2 bg-green-600 rounded-full animate-pulse"></span> AI READY';
            } else {
                badge.className = 'status-badge status-error';
                badge.innerHTML = '<span class="w-2 h-2 bg-red-600 rounded-full"></span> API ERROR';
            }
        }

        function getAutoPrompt(word) {
            return `Anda adalah pakar Sharaf. Analisis kata "${word}".

TENTUKAN apakah ini FI'IL atau ISIM.

JIKA FI'IL, berikan format JSON:
{
    "type": "fiil",
    "bab_title": "Nama Bab",
    "main_pattern": "Pola (contoh: ÙÙØ¹ÙÙ„Ù - ÙŠÙÙÙ’Ø¹ÙÙ„Ù)",
    "root": "Akar kata 3 huruf",
    "rows": [
        {"label": "Madhi Ma'lum", "wazan": "ÙÙØ¹ÙÙ„Ù", "mauzun": "...", "arti": "..."},
        {"label": "Mudhari Ma'lum", "wazan": "ÙŠÙÙÙ’Ø¹ÙÙ„Ù", "mauzun": "...", "arti": "..."},
        {"label": "Mashdar", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Isim Fa'il", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Isim Maf'ul", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Fi'il Amr", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Fi'il Nahi", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Isim Zaman/Makan", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Madhi Majhul", "wazan": "...", "mauzun": "...", "arti": "..."},
        {"label": "Mudhari Majhul", "wazan": "...", "mauzun": "...", "arti": "..."}
    ],
    "tashrif_lughawi": {
        "madhi": [
            {"dhamir": "Ù‡ÙÙˆÙ", "dhamir_label": "Dia lk", "fiil": "...", "arti": "Dia (lk) telah ..."},
            {"dhamir": "Ù‡ÙÙ…ÙØ§", "dhamir_label": "Mereka 2 lk", "fiil": "...", "arti": "Mereka berdua (lk) telah ..."},
            {"dhamir": "Ù‡ÙÙ…Ù’", "dhamir_label": "Mereka lk", "fiil": "...", "arti": "Mereka (lk) telah ..."},
            {"dhamir": "Ù‡ÙÙŠÙ", "dhamir_label": "Dia pr", "fiil": "...", "arti": "Dia (pr) telah ..."},
            {"dhamir": "Ù‡ÙÙ…ÙØ§", "dhamir_label": "Mereka 2 pr", "fiil": "...", "arti": "Mereka berdua (pr) telah ..."},
            {"dhamir": "Ù‡ÙÙ†ÙÙ‘", "dhamir_label": "Mereka pr", "fiil": "...", "arti": "Mereka (pr) telah ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙ", "dhamir_label": "Kamu lk", "fiil": "...", "arti": "Kamu (lk) telah ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…ÙØ§", "dhamir_label": "Kalian 2", "fiil": "...", "arti": "Kalian berdua telah ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…Ù’", "dhamir_label": "Kalian lk", "fiil": "...", "arti": "Kalian (lk) telah ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙ", "dhamir_label": "Kamu pr", "fiil": "...", "arti": "Kamu (pr) telah ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…ÙØ§", "dhamir_label": "Kalian 2 pr", "fiil": "...", "arti": "Kalian berdua (pr) telah ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ†ÙÙ‘", "dhamir_label": "Kalian pr", "fiil": "...", "arti": "Kalian (pr) telah ..."},
            {"dhamir": "Ø£ÙÙ†ÙØ§", "dhamir_label": "Saya", "fiil": "...", "arti": "Saya telah ..."},
            {"dhamir": "Ù†ÙØ­Ù’Ù†Ù", "dhamir_label": "Kami", "fiil": "...", "arti": "Kami telah ..."}
        ],
        "mudhari": [
            {"dhamir": "Ù‡ÙÙˆÙ", "dhamir_label": "Dia lk", "fiil": "...", "arti": "Dia (lk) sedang/akan ..."},
            {"dhamir": "Ù‡ÙÙ…ÙØ§", "dhamir_label": "Mereka 2 lk", "fiil": "...", "arti": "Mereka berdua (lk) sedang/akan ..."},
            {"dhamir": "Ù‡ÙÙ…Ù’", "dhamir_label": "Mereka lk", "fiil": "...", "arti": "Mereka (lk) sedang/akan ..."},
            {"dhamir": "Ù‡ÙÙŠÙ", "dhamir_label": "Dia pr", "fiil": "...", "arti": "Dia (pr) sedang/akan ..."},
            {"dhamir": "Ù‡ÙÙ…ÙØ§", "dhamir_label": "Mereka 2 pr", "fiil": "...", "arti": "Mereka berdua (pr) sedang/akan ..."},
            {"dhamir": "Ù‡ÙÙ†ÙÙ‘", "dhamir_label": "Mereka pr", "fiil": "...", "arti": "Mereka (pr) sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙ", "dhamir_label": "Kamu lk", "fiil": "...", "arti": "Kamu (lk) sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…ÙØ§", "dhamir_label": "Kalian 2", "fiil": "...", "arti": "Kalian berdua sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…Ù’", "dhamir_label": "Kalian lk", "fiil": "...", "arti": "Kalian (lk) sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙ", "dhamir_label": "Kamu pr", "fiil": "...", "arti": "Kamu (pr) sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…ÙØ§", "dhamir_label": "Kalian 2 pr", "fiil": "...", "arti": "Kalian berdua (pr) sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ†ÙÙ‘", "dhamir_label": "Kalian pr", "fiil": "...", "arti": "Kalian (pr) sedang/akan ..."},
            {"dhamir": "Ø£ÙÙ†ÙØ§", "dhamir_label": "Saya", "fiil": "...", "arti": "Saya sedang/akan ..."},
            {"dhamir": "Ù†ÙØ­Ù’Ù†Ù", "dhamir_label": "Kami", "fiil": "...", "arti": "Kami sedang/akan ..."}
        ],
        "amr": [
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙ", "dhamir_label": "Kamu lk", "fiil": "...", "arti": "...lah! (untuk lk)"},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…ÙØ§", "dhamir_label": "Kalian 2", "fiil": "...", "arti": "...lah! (untuk 2 orang)"},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…Ù’", "dhamir_label": "Kalian lk", "fiil": "...", "arti": "...lah! (untuk lk jamak)"},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙ", "dhamir_label": "Kamu pr", "fiil": "...", "arti": "...lah! (untuk pr)"},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ…ÙØ§", "dhamir_label": "Kalian 2 pr", "fiil": "...", "arti": "...lah! (untuk 2 pr)"},
            {"dhamir": "Ø£ÙÙ†Ù’ØªÙÙ†ÙÙ‘", "dhamir_label": "Kalian pr", "fiil": "...", "arti": "...lah! (untuk pr jamak)"}
        ]
    }
}

JIKA ISIM, berikan format JSON:
{
    "type": "isim",
    "word": "Kata yang dianalisis",
    "category": "Musytaq/Jamid",
    "subcategory": "Jenis spesifik (Isim Fa'il, Isim Maf'ul, dll)",
    "wazan": "Pola/Wazan",
    "root": "Akar kata",
    "meaning": "Arti",
    "gender": "Mudzakkar/Muannats",
    "number_type": "Mufrad/Mutsanna/Jamak",
    "derived_from": "Fi'il asal (jika musytaq)",
    "derived_from_meaning": "Arti fi'il asal",
    "forms": [
        {"label": "Mufrad", "arabic": "...", "note": "..."},
        {"label": "Mutsanna", "arabic": "...", "note": "..."},
        {"label": "Jamak", "arabic": "...", "note": "..."},
        {"label": "Muannats", "arabic": "...", "note": "..."},
        {"label": "Tashghir", "arabic": "...", "note": "..."},
        {"label": "Nisbah", "arabic": "...", "note": "..."}
    ],
    "related_words": [
        {"word": "...", "type": "...", "meaning": "..."}
    ]
}`;
        }

        function renderFiilResult(res) {
            const container = document.getElementById('tashrifContainer');
            document.getElementById('babText').innerText = res.bab_title.toUpperCase();
            document.getElementById('patternText').innerText = res.main_pattern;
            document.getElementById('rootText').innerText = res.root ? `Akar: ${res.root}` : '';
            container.innerHTML = '';

            const accents = ['#ffff00', '#00ffff', '#ff69b4', '#00ff00', '#ff8c00', '#E879F9', '#38bdf8', '#a3e635', '#fb923c', '#f472b6'];

            res.rows.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'row-tashrif';
                const color = accents[i % accents.length];
                
                div.innerHTML = `
                    <div class="label-cell">
                        <span class="w-2 h-2 md:w-3 md:h-3 brutal-border flex-shrink-0" style="background:${color}"></span>
                        <span>${item.label}</span>
                    </div>
                    <div class="wazan-mauzun-container">
                        <div class="arabic-text wazan-cell flex-1">${item.wazan}</div>
                        <span class="arrow-indicator">â†’</span>
                        <div class="arabic-text flex-1 text-center">
                            <span class="mauzun-cell" style="background: linear-gradient(180deg, transparent 65%, ${color} 65%);">${item.mauzun}</span>
                        </div>
                    </div>
                    <div class="meaning-cell">"${item.arti}"</div>
                `;
                container.appendChild(div);
            });

            if (res.tashrif_lughawi) {
                renderLughawi('lughawiMadhi', res.tashrif_lughawi.madhi);
                renderLughawi('lughawiMudhari', res.tashrif_lughawi.mudhari);
                renderLughawi('lughawiAmr', res.tashrif_lughawi.amr);
            }

            document.getElementById('resultFiil').classList.remove('hidden');
            scrollToResult('resultFiil');
        }

        function renderLughawi(containerId, data) {
            const container = document.getElementById(containerId);
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">Data tidak tersedia</div>';
                return;
            }

            const ghaibMale = data.slice(0, 3);
            const ghaibFemale = data.slice(3, 6);
            const mukhatabMale = data.slice(6, 9);
            const mukhatabFemale = data.slice(9, 12);
            const mutakallim = data.slice(12, 14);

            let html = `
                <div class="border-2 border-black border-t-0">
                    <div class="bg-blue-100 px-3 py-2 border-b-2 border-black font-bold text-xs uppercase">
                        <i class="fas fa-user-secret mr-1"></i> Ghaib (Orang Ketiga)
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2">
                        <div class="border-b md:border-b-0 md:border-r-2 border-black">
                            <div class="bg-blue-50 px-2 py-1 text-center text-xs font-bold border-b border-gray-300">
                                <i class="fas fa-mars mr-1"></i> Mudzakkar
                            </div>
                            ${ghaibMale.map(item => createLughawiRow(item, 'gender-male')).join('')}
                        </div>
                        <div>
                            <div class="bg-pink-50 px-2 py-1 text-center text-xs font-bold border-b border-gray-300">
                                <i class="fas fa-venus mr-1"></i> Muannats
                            </div>
                            ${ghaibFemale.map(item => createLughawiRow(item, 'gender-female')).join('')}
                        </div>
                    </div>

                    <div class="bg-green-100 px-3 py-2 border-y-2 border-black font-bold text-xs uppercase">
                        <i class="fas fa-user mr-1"></i> Mukhatab (Orang Kedua)
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2">
                        <div class="border-b md:border-b-0 md:border-r-2 border-black">
                            <div class="bg-blue-50 px-2 py-1 text-center text-xs font-bold border-b border-gray-300">
                                <i class="fas fa-mars mr-1"></i> Mudzakkar
                            </div>
                            ${mukhatabMale.map(item => createLughawiRow(item, 'gender-male')).join('')}
                        </div>
                        <div>
                            <div class="bg-pink-50 px-2 py-1 text-center text-xs font-bold border-b border-gray-300">
                                <i class="fas fa-venus mr-1"></i> Muannats
                            </div>
                            ${mukhatabFemale.map(item => createLughawiRow(item, 'gender-female')).join('')}
                        </div>
                    </div>

                    <div class="bg-yellow-100 px-3 py-2 border-y-2 border-black font-bold text-xs uppercase">
                        <i class="fas fa-user-circle mr-1"></i> Mutakallim (Orang Pertama)
                    </div>
                    <div>
                        ${mutakallim.map(item => createLughawiRow(item, 'gender-mixed')).join('')}
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function createLughawiRow(item, genderClass) {
            if (!item) return '';
            return `
                <div class="lughawi-row ${genderClass}">
                    <div class="lughawi-dhamir arabic-text">
                        ${item.dhamir}
                        <span class="lughawi-dhamir-label">${item.dhamir_label}</span>
                    </div>
                    <div class="lughawi-fiil arabic-text">${item.fiil}</div>
                    <div class="lughawi-meaning">${item.arti}</div>
                </div>
            `;
        }

        function renderIsimResult(res) {
            document.getElementById('isimTypeText').innerText = `${res.category} - ${res.subcategory}`.toUpperCase();
            document.getElementById('isimWordText').innerText = res.word;
            
            const infoGrid = document.getElementById('isimInfoGrid');
            infoGrid.innerHTML = `
                <div class="info-card"><div class="info-label">Akar Kata</div><div class="info-value info-value-ar arabic-text">${res.root || '-'}</div></div>
                <div class="info-card"><div class="info-label">Wazan</div><div class="info-value info-value-ar arabic-text">${res.wazan || '-'}</div></div>
                <div class="info-card"><div class="info-label">Gender</div><div class="info-value">${res.gender || '-'}</div></div>
                <div class="info-card"><div class="info-label">Arti</div><div class="info-value">${res.meaning || '-'}</div></div>
            `;

            const derivSection = document.getElementById('derivationSection');
            if (res.category === 'Musytaq' && res.derived_from) {
                derivSection.innerHTML = `
                    <div class="derivation-box">
                        <div class="text-xs font-bold uppercase mb-2 text-gray-600">Derivasi dari Fi'il</div>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-4">
                            <div class="text-center">
                                <div class="arabic-text text-2xl md:text-3xl font-bold">${res.derived_from}</div>
                                <div class="text-xs mt-1">${res.derived_from_meaning || 'Fi\'il Asal'}</div>
                            </div>
                            <div class="derivation-arrow">â†’</div>
                            <div class="text-center">
                                <div class="arabic-text text-2xl md:text-3xl font-bold text-blue-700">${res.word}</div>
                                <div class="text-xs mt-1">${res.subcategory}</div>
                            </div>
                        </div>
                    </div>
                `;
                derivSection.classList.remove('hidden');
            } else {
                derivSection.classList.add('hidden');
            }

            const container = document.getElementById('isimContainer');
            container.innerHTML = '';

            const colors = ['#60a5fa', '#34d399', '#fbbf24', '#f472b6', '#a78bfa', '#fb7185', '#2dd4bf'];

            if (res.forms && res.forms.length > 0) {
                res.forms.forEach((form, i) => {
                    if (form.arabic && form.arabic !== '-') {
                        const div = document.createElement('div');
                        div.className = 'row-isim';
                        const color = colors[i % colors.length];
                        
                        div.innerHTML = `
                            <div class="label-cell" style="background: ${color}; color: #000; padding: 8px 12px;">
                                <span>${form.label}</span>
                            </div>
                            <div class="arabic-text text-center text-xl md:text-2xl font-bold py-2">${form.arabic}</div>
                            <div class="text-xs md:text-sm text-gray-600 text-center md:text-right py-2">${form.note || ''}</div>
                        `;
                        container.appendChild(div);
                    }
                });
            }

            if (res.related_words && res.related_words.length > 0) {
                const relatedDiv = document.createElement('div');
                relatedDiv.className = 'p-4 bg-gray-100 border-t-3 border-black';
                relatedDiv.innerHTML = `
                    <div class="text-xs font-bold uppercase mb-3"><i class="fas fa-link mr-1"></i> Kata Terkait</div>
                    <div class="flex flex-wrap gap-2">
                        ${res.related_words.map(w => `
                            <span class="bg-white border-2 border-black px-3 py-1 text-sm">
                                <span class="arabic-text font-bold">${w.word}</span>
                                <span class="text-gray-500 text-xs ml-2">(${w.type}: ${w.meaning})</span>
                            </span>
                        `).join('')}
                    </div>
                `;
                container.appendChild(relatedDiv);
            }

            document.getElementById('resultIsim').classList.remove('hidden');
            scrollToResult('resultIsim');
        }

        function scrollToResult(elementId) {
            setTimeout(() => {
                document.getElementById(elementId).scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function showBrutalAlert(msg) {
            document.getElementById('errorMessage').textContent = msg;
            document.getElementById('errorModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('errorModal').classList.add('hidden');
        }

        document.getElementById('errorModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function() {
            updateApiKeyUI();
        });
    </script>
</body>
</html>
